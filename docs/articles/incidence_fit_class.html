<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Details of the incidence_fit class • incidence</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Details of the incidence_fit class">
<meta property="og:description" content="incidence">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">incidence</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.7.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Using the incidence package</li>
    <li>
      <a href="../articles/overview.html">Overview</a>
    </li>
    <li>
      <a href="../articles/customize_plot.html">Customising Epicurves (visualisation)</a>
    </li>
    <li>
      <a href="../articles/conversions.html">Exporting Incidence Data</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Understanding the incidence package</li>
    <li>
      <a href="../articles/incidence_class.html">The incidence class (data)</a>
    </li>
    <li>
      <a href="../articles/incidence_fit_class.html">The incidence_fit class (models)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/reconhub/incidence">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="incidence_fit_class_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Details of the incidence_fit class</h1>
                        <h4 class="author">Zhian N. Kamvar</h4>
            
            <h4 class="date">2020-07-23</h4>
      
      <small class="dont-index">Source: <a href="http://github.com/reconhub/incidence/blob/master/vignettes/incidence_fit_class.Rmd"><code>vignettes/incidence_fit_class.Rmd</code></a></small>
      <div class="hidden name"><code>incidence_fit_class.Rmd</code></div>

    </div>

    
    
<p>This vignette details the structure and construction of the <code>incidence_fit</code> and <code>incidence_fit_list</code> classes, which are produced by the <code><a href="../reference/fit.html">fit()</a></code> and <code><a href="../reference/fit.html">fit_optim_split()</a></code> functions, respectively. By the end of this tutorial, you should be able to construct <code>incidence_fit</code> and <code>incidence_fit_list</code> objects for use with your own models.</p>
<div id="structure-of-an-incidence_fit-object" class="section level1">
<h1 class="hasAnchor">
<a href="#structure-of-an-incidence_fit-object" class="anchor"></a>Structure of an <code>incidence_fit</code> object</h1>
<p>An <code>incidence_fit</code> object contains three elements:</p>
<ul>
<li>
<code>$model</code>: The model fit to an <code>incidence</code> object. Currently, this represents a log-linear model, but it can be any model.</li>
<li>
<code>$info</code>: Information derived from the model
<ul>
<li>
<code>r</code> The growth rate</li>
<li>
<code>r.conf</code> the confidence interval of <code>r</code>
</li>
<li>
<code>pred</code> a data frame containing the predictions of the model using the true dates (<code>dates</code>), their numeric version used in the model (<code>dates.x</code>), the predicted value (<code>fit</code>), and the lower (<code>lwr</code>) and upper (<code>upr</code>) bounds of the associated confidence interval.</li>
<li>
<code>doubling</code> the predicted doubling time in days (only if <code>r</code> is positive)</li>
<li>
<code>doubling.conf</code> the confidence interval of the doubling time</li>
<li>
<code>halving</code> the predicted halving time in days (only if <code>r</code> is negative)</li>
<li>
<code>halving.conf</code> the confidence interval of the halving time</li>
</ul>
</li>
<li>
<code>$origin</code>: the date corresponding to day ‘0’</li>
</ul>
<p>Internally, when <code><a href="../reference/fit.html">fit()</a></code> is run, these elements are constructed by function <code>incidence:::extract_info()</code>. First we need to setup data. We will use simulated Ebola outbreak data from the <em>outbreaks</em> package over weekly intervals and calculate the fit for the first 20 weeks:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">outbreaks</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">incidence</span>)
<span class="no">dat</span> <span class="kw">&lt;-</span> <span class="no">ebola_sim</span>$<span class="no">linelist</span>$<span class="no">date_of_onset</span>
<span class="no">i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/incidence.html">incidence</a></span>(<span class="no">dat</span>, <span class="kw">interval</span> <span class="kw">=</span> <span class="st">"week"</span>)
<span class="no">i</span>
<span class="co">#&gt; &lt;incidence object&gt;</span>
<span class="co">#&gt; [5888 cases from days 2014-04-07 to 2015-04-27]</span>
<span class="co">#&gt; [5888 cases from ISO weeks 2014-W15 to 2015-W18]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $counts: matrix with 56 rows and 1 columns</span>
<span class="co">#&gt; $n: 5888 cases in total</span>
<span class="co">#&gt; $dates: 56 dates marking the left-side of bins</span>
<span class="co">#&gt; $interval: 1 week</span>
<span class="co">#&gt; $timespan: 386 days</span>
<span class="co">#&gt; $cumulative: FALSE</span>
<span class="no">f</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fit.html">fit</a></span>(<span class="no">i</span>[<span class="fl">1</span>:<span class="fl">20</span>])
<span class="no">f</span>
<span class="co">#&gt; &lt;incidence_fit object&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $model: regression of log-incidence over time</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $info: list containing the following items:</span>
<span class="co">#&gt;   $r (daily growth rate):</span>
<span class="co">#&gt; [1] 0.03175771</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $r.conf (confidence interval):</span>
<span class="co">#&gt;           2.5 %     97.5 %</span>
<span class="co">#&gt; [1,] 0.02596229 0.03755314</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $doubling (doubling time in days):</span>
<span class="co">#&gt; [1] 21.8261</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $doubling.conf (confidence interval):</span>
<span class="co">#&gt;         2.5 %   97.5 %</span>
<span class="co">#&gt; [1,] 18.45777 26.69823</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $pred: data.frame of incidence predictions (20 rows, 5 columns)</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">i</span>, <span class="kw">fit</span> <span class="kw">=</span> <span class="no">f</span>)</pre></body></html></div>
<p><img src="incidence_fit_class_files/figure-html/fit_dates-1.png" width="672"></p>
<p>As you can see, the <code>incidence_fit</code> object has a print method and a plot method. If you want to access individual elements in the <code>$info</code> element, you can use the <code><a href="../reference/get_fit.html">get_info()</a></code> function:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="../reference/get_fit.html">get_info</a></span>(<span class="no">f</span>, <span class="st">"r"</span>)
<span class="co">#&gt; [1] 0.03175771</span>
<span class="fu"><a href="../reference/get_fit.html">get_info</a></span>(<span class="no">f</span>, <span class="st">"r.conf"</span>)
<span class="co">#&gt;           2.5 %     97.5 %</span>
<span class="co">#&gt; [1,] 0.02596229 0.03755314</span>
<span class="fu"><a href="../reference/get_fit.html">get_info</a></span>(<span class="no">f</span>, <span class="st">"doubling.conf"</span>)
<span class="co">#&gt;         2.5 %   97.5 %</span>
<span class="co">#&gt; [1,] 18.45777 26.69823</span></pre></body></html></div>
<p>This will be important later when we combine several <code>incidence_fit</code> objects into a single <code>incidence_fit_list</code>.</p>
</div>
<div id="building-an-incidence_fit-object-from-scratch" class="section level1">
<h1 class="hasAnchor">
<a href="#building-an-incidence_fit-object-from-scratch" class="anchor"></a>Building an <code>incidence_fit</code> object from scratch</h1>
<p>The <code>incidence_fit</code> object can be constructed from any model from which you can derive the daily growth rate, doubling/halving times, predictions, and confidence intervals. The following three steps show roughly how it is done from model fitting to construction.</p>
<div id="step-1-create-the-model" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1-create-the-model" class="anchor"></a>Step 1: create the model</h3>
<p>The default model for <code><a href="../reference/fit.html">fit()</a></code> is a log-linear model on the intervals between dates. To fit this model, we will need to create a data frame with the counts and the midpoints of the intervals:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># ensure all dates have at least one incidence</span>
<span class="no">i2</span> <span class="kw">&lt;-</span> <span class="no">i</span>[<span class="fl">1</span>:<span class="fl">20</span>]
<span class="no">i2</span> <span class="kw">&lt;-</span> <span class="no">i2</span>[<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="fu"><a href="../reference/get_counts.html">get_counts</a></span>(<span class="no">i2</span>), <span class="fl">1</span>, <span class="no">min</span>) <span class="kw">&gt;</span> <span class="fl">0</span>]
<span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">i2</span>, <span class="kw">long</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">df</span>$<span class="no">dates.x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_dates.html">get_dates</a></span>(<span class="no">i2</span>, <span class="kw">position</span> <span class="kw">=</span> <span class="st">"center"</span>, <span class="kw">count_days</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df</span>)
<span class="co">#&gt;        dates    weeks isoweeks counts dates.x</span>
<span class="co">#&gt; 1 2014-04-07 2014-W15 2014-W15      1     3.5</span>
<span class="co">#&gt; 2 2014-04-14 2014-W16 2014-W16      1    10.5</span>
<span class="co">#&gt; 3 2014-04-21 2014-W17 2014-W17      5    17.5</span>
<span class="co">#&gt; 4 2014-04-28 2014-W18 2014-W18      4    24.5</span>
<span class="co">#&gt; 5 2014-05-05 2014-W19 2014-W19     12    31.5</span>
<span class="co">#&gt; 6 2014-05-12 2014-W20 2014-W20     18    38.5</span>
<span class="no">lm1</span> <span class="kw">&lt;-</span> <span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">counts</span>) ~ <span class="no">dates.x</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">df</span>)
<span class="no">lm1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; stats::lm(formula = log(counts) ~ dates.x, data = df)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)      dates.x  </span>
<span class="co">#&gt;     0.81660      0.03176</span></pre></body></html></div>
<p>If we compare that to the <code>$model</code> element produced from <code><a href="../reference/fit.html">fit()</a></code>, we can see that it is identical:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(<span class="no">f</span>$<span class="no">model</span>, <span class="no">lm1</span>)
<span class="co">#&gt; [1] TRUE</span></pre></body></html></div>
</div>
<div id="step-2-creation-of-the-info-list" class="section level3">
<h3 class="hasAnchor">
<a href="#step-2-creation-of-the-info-list" class="anchor"></a>Step 2: creation of the <code>$info</code> list:</h3>
<p>The <code>$info</code> list is created directly from the model itself:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">r</span> <span class="kw">&lt;-</span> <span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(<span class="no">lm1</span>)[<span class="st">"dates.x"</span>]
<span class="no">r.conf</span> <span class="kw">&lt;-</span> <span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span>(<span class="no">lm1</span>, <span class="st">"dates.x"</span>, <span class="fl">0.95</span>)
<span class="no">new.data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">dates.x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">lm1</span>$<span class="no">model</span>$<span class="no">dates.x</span>)))
<span class="no">pred</span>     <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="kw pkg">stats</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">lm1</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">new.data</span>, <span class="kw">interval</span> <span class="kw">=</span> <span class="st">"confidence"</span>,
                               <span class="kw">level</span> <span class="kw">=</span> <span class="fl">0.95</span>))
<span class="no">pred</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind.data.frame</a></span>(<span class="no">new.data</span>, <span class="no">pred</span>)
<span class="no">info_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">r</span> <span class="kw">=</span> <span class="no">r</span>,
  <span class="kw">r.conf</span> <span class="kw">=</span> <span class="no">r.conf</span>,
  <span class="kw">doubling</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="fl">2</span>) / <span class="no">r</span>,
  <span class="kw">doubling.conf</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="fl">2</span>) / <span class="no">r.conf</span>,
  <span class="kw">pred</span> <span class="kw">=</span> <span class="no">pred</span>
)
<span class="no">info_list</span>
<span class="co">#&gt; $r</span>
<span class="co">#&gt;    dates.x </span>
<span class="co">#&gt; 0.03175771 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $r.conf</span>
<span class="co">#&gt;              2.5 %     97.5 %</span>
<span class="co">#&gt; dates.x 0.02596229 0.03755314</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $doubling</span>
<span class="co">#&gt; dates.x </span>
<span class="co">#&gt; 21.8261 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $doubling.conf</span>
<span class="co">#&gt;            2.5 %   97.5 %</span>
<span class="co">#&gt; dates.x 26.69823 18.45777</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $pred</span>
<span class="co">#&gt;    dates.x        fit        lwr        upr</span>
<span class="co">#&gt; 1      3.5   2.528815   1.611099   3.969283</span>
<span class="co">#&gt; 2     10.5   3.158367   2.082082   4.791013</span>
<span class="co">#&gt; 3     17.5   3.944645   2.687383   5.790104</span>
<span class="co">#&gt; 4     24.5   4.926668   3.463102   7.008763</span>
<span class="co">#&gt; 5     31.5   6.153167   4.453513   8.501484</span>
<span class="co">#&gt; 6     38.5   7.685004   5.711842  10.339797</span>
<span class="co">#&gt; 7     45.5   9.598194   7.300398  12.619220</span>
<span class="co">#&gt; 8     52.5  11.987674   9.289763  15.469105</span>
<span class="co">#&gt; 9     59.5  14.972017  11.757263  19.065771</span>
<span class="co">#&gt; 10    66.5  18.699315  14.786028  23.648299</span>
<span class="co">#&gt; 11    73.5  23.354529  18.467024  29.535566</span>
<span class="co">#&gt; 12    80.5  29.168662  22.905640  37.144163</span>
<span class="co">#&gt; 13    87.5  36.430229  28.231348  47.010209</span>
<span class="co">#&gt; 14    94.5  45.499570  34.607028  59.820534</span>
<span class="co">#&gt; 15   101.5  56.826734  42.236196  76.457588</span>
<span class="co">#&gt; 16   108.5  70.973805  51.369116  98.060497</span>
<span class="co">#&gt; 17   115.5  88.642805  62.309665 126.104782</span>
<span class="co">#&gt; 18   122.5 110.710519  75.424156 162.505217</span>
<span class="co">#&gt; 19   129.5 138.272012  91.152689 209.748604</span>
<span class="co">#&gt; 20   136.5 172.694966 110.023332 271.065700</span></pre></body></html></div>
</div>
<div id="step-3-combine-lists-and-create-object" class="section level3">
<h3 class="hasAnchor">
<a href="#step-3-combine-lists-and-create-object" class="anchor"></a>Step 3: combine lists and create object</h3>
<p>the last step is to combine everything into a list and create the object.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">origin</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="fu"><a href="../reference/get_dates.html">get_dates</a></span>(<span class="no">i2</span>))
<span class="no">info_list</span>$<span class="no">pred</span>$<span class="no">dates</span> <span class="kw">&lt;-</span> <span class="no">origin</span> + <span class="no">info_list</span>$<span class="no">pred</span>$<span class="no">dates.x</span>
<span class="no">the_fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">lm</span> <span class="kw">=</span> <span class="no">lm1</span>,
  <span class="kw">info</span> <span class="kw">=</span> <span class="no">info_list</span>,
  <span class="kw">origin</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="fu"><a href="../reference/get_dates.html">get_dates</a></span>(<span class="no">i2</span>))
)
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">the_fit</span>) <span class="kw">&lt;-</span> <span class="st">"incidence_fit"</span>
<span class="no">the_fit</span>
<span class="co">#&gt; &lt;incidence_fit object&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $model: regression of log-incidence over time</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $info: list containing the following items:</span>
<span class="co">#&gt;   $r (daily growth rate):</span>
<span class="co">#&gt;    dates.x </span>
<span class="co">#&gt; 0.03175771 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $r.conf (confidence interval):</span>
<span class="co">#&gt;              2.5 %     97.5 %</span>
<span class="co">#&gt; dates.x 0.02596229 0.03755314</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $doubling (doubling time in days):</span>
<span class="co">#&gt; dates.x </span>
<span class="co">#&gt; 21.8261 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $doubling.conf (confidence interval):</span>
<span class="co">#&gt;            2.5 %   97.5 %</span>
<span class="co">#&gt; dates.x 26.69823 18.45777</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $pred: data.frame of incidence predictions (20 rows, 5 columns)</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">i</span>, <span class="kw">fit</span> <span class="kw">=</span> <span class="no">the_fit</span>)</pre></body></html></div>
<p><img src="incidence_fit_class_files/figure-html/combine-1.png" width="672"></p>
</div>
</div>
<div id="structure-of-an-incidence_fit_list-object" class="section level1">
<h1 class="hasAnchor">
<a href="#structure-of-an-incidence_fit_list-object" class="anchor"></a>Structure of an <code>incidence_fit_list</code> object</h1>
<p>There are several reasons for having multiple fits to a single <code>incidence</code> object. One may want to have a separate fit for different groups represented in the object, or one may want to split the fits at the peak of the epidemic. To aid in plotting and summarizing the different fits, we’ve created the <code>incidence_fit_list</code> class. This class has two defining features:</p>
<ul>
<li>It consists of a named list containing one or more <code>incidence_fit</code> objects or lists containing <code>incidence_fit</code> objects.</li>
<li>An attribute called “locations” contains a list whose length is equal to the number of <code>incidence_fit</code> objects in the object. Each list element contains a vector that defines where an <code>incidence_fit</code> object is within the <code>incidence_fit_list</code>.</li>
</ul>
<p>The reason for this structure is because it is sometimes necessary to nest lists of <code>incidence_fit</code> objects within lists. When this happens, accessing individual elements of the objects cumbersome. To alleviate this, each object has a distinct path within the named list in the “locations” attribute that allows one to access the object directly since R allows you to traverse the elements of a nested list by subsetting with a vector:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">l</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">a</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">b</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">c</span> <span class="kw">=</span> <span class="fl">2</span>),<span class="kw">d</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">e</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">f</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">g</span> <span class="kw">=</span> <span class="fl">4</span>), <span class="kw">h</span> <span class="kw">=</span> <span class="fl">5</span>))
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">l</span>)
<span class="co">#&gt; List of 2</span>
<span class="co">#&gt;  $ a:List of 2</span>
<span class="co">#&gt;   ..$ b: num 1</span>
<span class="co">#&gt;   ..$ c: num 2</span>
<span class="co">#&gt;  $ d:List of 2</span>
<span class="co">#&gt;   ..$ e:List of 2</span>
<span class="co">#&gt;   .. ..$ f: num 3</span>
<span class="co">#&gt;   .. ..$ g: num 4</span>
<span class="co">#&gt;   ..$ h: num 5</span>
<span class="no">l</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"a"</span>, <span class="st">"b"</span>)]]
<span class="co">#&gt; [1] 1</span>
<span class="no">l</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"d"</span>, <span class="st">"e"</span>, <span class="st">"f"</span>)]]
<span class="co">#&gt; [1] 3</span></pre></body></html></div>
<div id="example-a-tale-of-two-fits" class="section level2">
<h2 class="hasAnchor">
<a href="#example-a-tale-of-two-fits" class="anchor"></a>Example: A tale of two fits</h2>
<p>The function <code><a href="../reference/fit.html">fit_optim_split()</a></code> attempts to find the optimal split point in an epicurve, producing an <code>incidence_fit_list</code> object in the <code>$fit</code> element of the returned list:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">fl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fit.html">fit_optim_split</a></span>(<span class="no">i</span>)
<span class="no">fl</span>$<span class="no">fit</span>
<span class="co">#&gt; &lt;list of incidence_fit objects&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(x, 'locations'): list of vectors with the locations of each incidence_fit object</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 'before'</span>
<span class="co">#&gt; 'after'</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $model: regression of log-incidence over time</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $info: list containing the following items:</span>
<span class="co">#&gt;   $r (daily growth rate):</span>
<span class="co">#&gt;      before       after </span>
<span class="co">#&gt;  0.02982209 -0.01016191 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $r.conf (confidence interval):</span>
<span class="co">#&gt;              2.5 %       97.5 %</span>
<span class="co">#&gt; before  0.02608945  0.033554736</span>
<span class="co">#&gt; after  -0.01102526 -0.009298561</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $doubling (doubling time in days):</span>
<span class="co">#&gt;   before </span>
<span class="co">#&gt; 23.24274 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $doubling.conf (confidence interval):</span>
<span class="co">#&gt;           2.5 %  97.5 %</span>
<span class="co">#&gt; before 20.65721 26.5681</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $halving (halving time in days):</span>
<span class="co">#&gt;    after </span>
<span class="co">#&gt; 68.21031 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $halving.conf (confidence interval):</span>
<span class="co">#&gt;          2.5 %   97.5 %</span>
<span class="co">#&gt; after 62.86899 74.54349</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $pred: data.frame of incidence predictions (57 rows, 6 columns)</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">i</span>, <span class="kw">fit</span> <span class="kw">=</span> <span class="no">fl</span>$<span class="no">fit</span>)</pre></body></html></div>
<p><img src="incidence_fit_class_files/figure-html/incidence_fit_list-1.png" width="672"></p>
<p>Here you can see that the object looks very similar to the <code>incidence_fit</code> object, but it has extra information. The first thing you may notice is the fact that both “doubling” and “halving” are shown. This is because the two fits have different signs for the daily growth rate. The second thing you may notice is the fact that there is something called <code><a href="https://rdrr.io/r/base/attr.html">attr(x, 'locations')</a></code>. This attribute gives the location of the <code>incidence_fit</code> objects within the list. We can illustrate how this works if we look at the structure of the object:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">fl</span>$<span class="no">fit</span>, <span class="kw">max.level</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="co">#&gt; List of 2</span>
<span class="co">#&gt;  $ before:List of 3</span>
<span class="co">#&gt;   ..$ model :List of 12</span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr "lm"</span>
<span class="co">#&gt;   ..$ info  :List of 5</span>
<span class="co">#&gt;   ..$ origin: Date[1:1], format: "2014-04-07"</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr "incidence_fit"</span>
<span class="co">#&gt;  $ after :List of 3</span>
<span class="co">#&gt;   ..$ model :List of 12</span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr "lm"</span>
<span class="co">#&gt;   ..$ info  :List of 5</span>
<span class="co">#&gt;   ..$ origin: Date[1:1], format: "2014-09-22"</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr "incidence_fit"</span>
<span class="co">#&gt;  - attr(*, "locations")=List of 2</span>
<span class="co">#&gt;   ..$ : chr "before"</span>
<span class="co">#&gt;   ..$ : chr "after"</span>
<span class="co">#&gt;  - attr(*, "class")= chr "incidence_fit_list"</span></pre></body></html></div>
<p>Internally, all of the methods for <code>incidence_fit_list</code> use the ‘locations’ attribute to navigate:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/methods.html">methods</a></span>(<span class="kw">class</span> <span class="kw">=</span> <span class="st">"incidence_fit_list"</span>)
<span class="co">#&gt; [1] get_fit  get_info plot     print   </span>
<span class="co">#&gt; see '?methods' for accessing help and source code</span></pre></body></html></div>
<p>For example, it’s often useful to extract the growth rate for all models at once. The <code><a href="../reference/get_fit.html">get_info()</a></code> method allows us to do this easily:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/get_fit.html">get_info</a></span>(<span class="no">fl</span>$<span class="no">fit</span>, <span class="st">"r"</span>)
<span class="co">#&gt;      before       after </span>
<span class="co">#&gt;  0.02982209 -0.01016191</span>
<span class="fu"><a href="../reference/get_fit.html">get_info</a></span>(<span class="no">fl</span>$<span class="no">fit</span>, <span class="st">"r.conf"</span>)
<span class="co">#&gt;              2.5 %       97.5 %</span>
<span class="co">#&gt; before  0.02608945  0.033554736</span>
<span class="co">#&gt; after  -0.01102526 -0.009298561</span></pre></body></html></div>
<p>Because doubling or halving is determined by whether or not <code>r</code> is negative, we automatically filter out the results that don’t make sense, but you can include them with <code>na.rm = FALSE</code>:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="../reference/get_fit.html">get_info</a></span>(<span class="no">fl</span>$<span class="no">fit</span>, <span class="st">"doubling.conf"</span>)
<span class="co">#&gt;           2.5 %  97.5 %</span>
<span class="co">#&gt; before 20.65721 26.5681</span>
<span class="fu"><a href="../reference/get_fit.html">get_info</a></span>(<span class="no">fl</span>$<span class="no">fit</span>, <span class="st">"doubling.conf"</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt;           2.5 %  97.5 %</span>
<span class="co">#&gt; before 20.65721 26.5681</span>
<span class="co">#&gt; after        NA      NA</span></pre></body></html></div>
</div>
<div id="example-nested-incidence_fit" class="section level2">
<h2 class="hasAnchor">
<a href="#example-nested-incidence_fit" class="anchor"></a>Example: Nested incidence_fit</h2>
<p>Above, we showed the example of a basic <code>incidence_fit_list</code> class with two objects representing the fits before and after the peak of an epicurve. However, it is often useful evaluate fits for different groups separately. Here, we will construct an incidence object, but define groups by gender:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">gen</span> <span class="kw">&lt;-</span> <span class="no">ebola_sim</span>$<span class="no">linelist</span>$<span class="no">gender</span>
<span class="no">ig</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/incidence.html">incidence</a></span>(<span class="no">dat</span>, <span class="kw">interval</span> <span class="kw">=</span> <span class="st">"week"</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">gen</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ig</span>, <span class="kw">border</span> <span class="kw">=</span> <span class="st">"grey98"</span>)</pre></body></html></div>
<p><img src="incidence_fit_class_files/figure-html/incidence_by_gender-1.png" width="672"></p>
<p>Now if we calculate an optimal fit split, we will end up with four different fits: two for each defined gender.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">fg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fit.html">fit_optim_split</a></span>(<span class="no">ig</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">ig</span>, <span class="kw">fit</span> <span class="kw">=</span> <span class="no">fg</span>$<span class="no">fit</span>, <span class="kw">border</span> <span class="kw">=</span> <span class="st">"grey98"</span>, <span class="kw">stack</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour',</span>
<span class="co">#&gt; which will replace the existing scale.</span>
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour',</span>
<span class="co">#&gt; which will replace the existing scale.</span>
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour',</span>
<span class="co">#&gt; which will replace the existing scale.</span>
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour',</span>
<span class="co">#&gt; which will replace the existing scale.</span></pre></body></html></div>
<p><img src="incidence_fit_class_files/figure-html/fit_gender-1.png" width="672"></p>
<p>If we look at the fit object, we can see again that it is an <code>incidence_fit_list</code> but this time with four fits defined.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">fg</span>$<span class="no">fit</span>
<span class="co">#&gt; &lt;list of incidence_fit objects&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(x, 'locations'): list of vectors with the locations of each incidence_fit object</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 'f', 'before'</span>
<span class="co">#&gt; 'm', 'before'</span>
<span class="co">#&gt; 'f', 'after'</span>
<span class="co">#&gt; 'm', 'after'</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $model: regression of log-incidence over time</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $info: list containing the following items:</span>
<span class="co">#&gt;   $r (daily growth rate):</span>
<span class="co">#&gt;    f_before    m_before     f_after     m_after </span>
<span class="co">#&gt;  0.02570604  0.02883607 -0.01002297 -0.01038307 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $r.conf (confidence interval):</span>
<span class="co">#&gt;                2.5 %       97.5 %</span>
<span class="co">#&gt; f_before  0.02289333  0.028518743</span>
<span class="co">#&gt; m_before  0.02502254  0.032649606</span>
<span class="co">#&gt; f_after  -0.01102735 -0.009018595</span>
<span class="co">#&gt; m_after  -0.01138910 -0.009377034</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $doubling (doubling time in days):</span>
<span class="co">#&gt; f_before m_before </span>
<span class="co">#&gt; 26.96437 24.03750 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $doubling.conf (confidence interval):</span>
<span class="co">#&gt;             2.5 %   97.5 %</span>
<span class="co">#&gt; f_before 24.30497 30.27725</span>
<span class="co">#&gt; m_before 21.22988 27.70091</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $halving (halving time in days):</span>
<span class="co">#&gt;  f_after  m_after </span>
<span class="co">#&gt; 69.15586 66.75746 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $halving.conf (confidence interval):</span>
<span class="co">#&gt;            2.5 %   97.5 %</span>
<span class="co">#&gt; f_after 62.85711 76.85756</span>
<span class="co">#&gt; m_after 60.86059 73.91966</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $pred: data.frame of incidence predictions (111 rows, 7 columns)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">fg</span>$<span class="no">fit</span>, <span class="kw">max.level</span> <span class="kw">=</span> <span class="fl">3</span>)
<span class="co">#&gt; List of 2</span>
<span class="co">#&gt;  $ f:List of 2</span>
<span class="co">#&gt;   ..$ before:List of 3</span>
<span class="co">#&gt;   .. ..$ model :List of 12</span>
<span class="co">#&gt;   .. .. ..- attr(*, "class")= chr "lm"</span>
<span class="co">#&gt;   .. ..$ info  :List of 5</span>
<span class="co">#&gt;   .. ..$ origin: Date[1:1], format: "2014-04-07"</span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr "incidence_fit"</span>
<span class="co">#&gt;   ..$ after :List of 3</span>
<span class="co">#&gt;   .. ..$ model :List of 12</span>
<span class="co">#&gt;   .. .. ..- attr(*, "class")= chr "lm"</span>
<span class="co">#&gt;   .. ..$ info  :List of 5</span>
<span class="co">#&gt;   .. ..$ origin: Date[1:1], format: "2014-09-22"</span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr "incidence_fit"</span>
<span class="co">#&gt;   ..- attr(*, "locations")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr "before"</span>
<span class="co">#&gt;   .. ..$ : chr "after"</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr "incidence_fit_list"</span>
<span class="co">#&gt;  $ m:List of 2</span>
<span class="co">#&gt;   ..$ before:List of 3</span>
<span class="co">#&gt;   .. ..$ model :List of 12</span>
<span class="co">#&gt;   .. .. ..- attr(*, "class")= chr "lm"</span>
<span class="co">#&gt;   .. ..$ info  :List of 5</span>
<span class="co">#&gt;   .. ..$ origin: Date[1:1], format: "2014-04-14"</span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr "incidence_fit"</span>
<span class="co">#&gt;   ..$ after :List of 3</span>
<span class="co">#&gt;   .. ..$ model :List of 12</span>
<span class="co">#&gt;   .. .. ..- attr(*, "class")= chr "lm"</span>
<span class="co">#&gt;   .. ..$ info  :List of 5</span>
<span class="co">#&gt;   .. ..$ origin: Date[1:1], format: "2014-09-15"</span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr "incidence_fit"</span>
<span class="co">#&gt;   ..- attr(*, "locations")=List of 2</span>
<span class="co">#&gt;   .. ..$ : chr "before"</span>
<span class="co">#&gt;   .. ..$ : chr "after"</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr "incidence_fit_list"</span>
<span class="co">#&gt;  - attr(*, "locations")=List of 4</span>
<span class="co">#&gt;   ..$ : chr [1:2] "f" "before"</span>
<span class="co">#&gt;   ..$ : chr [1:2] "m" "before"</span>
<span class="co">#&gt;   ..$ : chr [1:2] "f" "after"</span>
<span class="co">#&gt;   ..$ : chr [1:2] "m" "after"</span>
<span class="co">#&gt;  - attr(*, "class")= chr "incidence_fit_list"</span></pre></body></html></div>
<blockquote>
<p>Notice that the nested lists themselves are of class <code>incidence_fit_list</code>.</p>
</blockquote>
<p>Now, even though the fits within nested lists, the ‘locations’ attributes still defines where they are within the object so that the <code><a href="../reference/get_fit.html">get_info()</a></code> function still operates normally:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="../reference/get_fit.html">get_info</a></span>(<span class="no">fg</span>$<span class="no">fit</span>, <span class="st">"r.conf"</span>)
<span class="co">#&gt;                2.5 %       97.5 %</span>
<span class="co">#&gt; f_before  0.02289333  0.028518743</span>
<span class="co">#&gt; m_before  0.02502254  0.032649606</span>
<span class="co">#&gt; f_after  -0.01102735 -0.009018595</span>
<span class="co">#&gt; m_after  -0.01138910 -0.009377034</span></pre></body></html></div>
<p>If you need to access all the fits easily, a convenience function to flatten the list is available in <code><a href="../reference/get_fit.html">get_fit()</a></code>:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="fu"><a href="../reference/get_fit.html">get_fit</a></span>(<span class="no">fg</span>$<span class="no">fit</span>), <span class="kw">max.level</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="co">#&gt; List of 4</span>
<span class="co">#&gt;  $ f_before:List of 3</span>
<span class="co">#&gt;   ..$ model :List of 12</span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr "lm"</span>
<span class="co">#&gt;   ..$ info  :List of 5</span>
<span class="co">#&gt;   ..$ origin: Date[1:1], format: "2014-04-07"</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr "incidence_fit"</span>
<span class="co">#&gt;  $ m_before:List of 3</span>
<span class="co">#&gt;   ..$ model :List of 12</span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr "lm"</span>
<span class="co">#&gt;   ..$ info  :List of 5</span>
<span class="co">#&gt;   ..$ origin: Date[1:1], format: "2014-04-14"</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr "incidence_fit"</span>
<span class="co">#&gt;  $ f_after :List of 3</span>
<span class="co">#&gt;   ..$ model :List of 12</span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr "lm"</span>
<span class="co">#&gt;   ..$ info  :List of 5</span>
<span class="co">#&gt;   ..$ origin: Date[1:1], format: "2014-09-22"</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr "incidence_fit"</span>
<span class="co">#&gt;  $ m_after :List of 3</span>
<span class="co">#&gt;   ..$ model :List of 12</span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr "lm"</span>
<span class="co">#&gt;   ..$ info  :List of 5</span>
<span class="co">#&gt;   ..$ origin: Date[1:1], format: "2014-09-15"</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr "incidence_fit"</span></pre></body></html></div>
<p>Because all that defines an <code>incidence_fit_list</code> is the class definition and the ‘locations’ attribute that defines the positions of the <code>incidence_fit</code> objects within the nesting, then it’s also possible to define the output of <code><a href="../reference/fit.html">fit_optim_split()</a></code> as an <code>incidence_fit_list</code> class:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">locs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span>(<span class="no">fg</span>$<span class="no">fit</span>)$<span class="no">locations</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "f"      "before"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] "m"      "before"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] "f"     "after"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; [1] "m"     "after"</span>

<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span>(<span class="no">locs</span>)) {
    <span class="no">locs</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"fit"</span>, <span class="no">locs</span><span class="kw">[[</span><span class="no">i</span>]])
}
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">locs</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "fit"    "f"      "before"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] "fit"    "m"      "before"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] "fit"   "f"     "after"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; [1] "fit"   "m"     "after"</span>
<span class="no">fg.ifl</span> <span class="kw">&lt;-</span> <span class="no">fg</span>
<span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span>(<span class="no">fg.ifl</span>)$<span class="no">locations</span><span class="kw">&lt;-</span> <span class="no">locs</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">fg.ifl</span>) <span class="kw">&lt;-</span> <span class="st">"incidence_fit_list"</span></pre></body></html></div>
<p>Now when we print the object, we can see that it prints only the information related to the <code>incidence_fit_list</code>:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">fg.ifl</span>
<span class="co">#&gt; &lt;list of incidence_fit objects&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(x, 'locations'): list of vectors with the locations of each incidence_fit object</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 'fit', 'f', 'before'</span>
<span class="co">#&gt; 'fit', 'm', 'before'</span>
<span class="co">#&gt; 'fit', 'f', 'after'</span>
<span class="co">#&gt; 'fit', 'm', 'after'</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $model: regression of log-incidence over time</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $info: list containing the following items:</span>
<span class="co">#&gt;   $r (daily growth rate):</span>
<span class="co">#&gt; fit_f_before fit_m_before  fit_f_after  fit_m_after </span>
<span class="co">#&gt;   0.02570604   0.02883607  -0.01002297  -0.01038307 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $r.conf (confidence interval):</span>
<span class="co">#&gt;                    2.5 %       97.5 %</span>
<span class="co">#&gt; fit_f_before  0.02289333  0.028518743</span>
<span class="co">#&gt; fit_m_before  0.02502254  0.032649606</span>
<span class="co">#&gt; fit_f_after  -0.01102735 -0.009018595</span>
<span class="co">#&gt; fit_m_after  -0.01138910 -0.009377034</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $doubling (doubling time in days):</span>
<span class="co">#&gt; fit_f_before fit_m_before </span>
<span class="co">#&gt;     26.96437     24.03750 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $doubling.conf (confidence interval):</span>
<span class="co">#&gt;                 2.5 %   97.5 %</span>
<span class="co">#&gt; fit_f_before 24.30497 30.27725</span>
<span class="co">#&gt; fit_m_before 21.22988 27.70091</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $halving (halving time in days):</span>
<span class="co">#&gt; fit_f_after fit_m_after </span>
<span class="co">#&gt;    69.15586    66.75746 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $halving.conf (confidence interval):</span>
<span class="co">#&gt;                2.5 %   97.5 %</span>
<span class="co">#&gt; fit_f_after 62.85711 76.85756</span>
<span class="co">#&gt; fit_m_after 60.86059 73.91966</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   $pred: data.frame of incidence predictions (111 rows, 7 columns)</span></pre></body></html></div>
<p>But, we still retain all of the extra information in the list:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">fg.ifl</span>, <span class="kw">max.level</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="co">#&gt; List of 4</span>
<span class="co">#&gt;  $ df   :'data.frame':   26 obs. of  3 variables:</span>
<span class="co">#&gt;  $ plot :List of 9</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr [1:2] "gg" "ggplot"</span>
<span class="co">#&gt;  $ split: Date[1:2], format: "2014-09-22" "2014-09-15"</span>
<span class="co">#&gt;   ..- attr(*, "names")="f" "m"</span>
<span class="co">#&gt;  $ fit  :List of 2</span>
<span class="co">#&gt;   ..- attr(*, "locations")=List of 4</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr "incidence_fit_list"</span>
<span class="co">#&gt;  - attr(*, "locations")=List of 4</span>
<span class="co">#&gt;  - attr(*, "class")= chr "incidence_fit_list"</span>
<span class="no">fg.ifl</span>$<span class="no">split</span>
<span class="co">#&gt;            f            m </span>
<span class="co">#&gt; "2014-09-22" "2014-09-15"</span>
<span class="no">fg.ifl</span>$<span class="no">df</span>
<span class="co">#&gt;         dates   mean.R2 groups</span>
<span class="co">#&gt; 1  2014-08-04 0.7546016      f</span>
<span class="co">#&gt; 2  2014-08-11 0.8096672      f</span>
<span class="co">#&gt; 3  2014-08-18 0.8513743      f</span>
<span class="co">#&gt; 4  2014-08-25 0.8864424      f</span>
<span class="co">#&gt; 5  2014-09-01 0.9165063      f</span>
<span class="co">#&gt; 6  2014-09-08 0.9270248      f</span>
<span class="co">#&gt; 7  2014-09-15 0.9345352      f</span>
<span class="co">#&gt; 8  2014-09-22 0.9350323      f</span>
<span class="co">#&gt; 9  2014-09-29 0.9339121      f</span>
<span class="co">#&gt; 10 2014-10-06 0.9288956      f</span>
<span class="co">#&gt; 11 2014-10-13 0.9226037      f</span>
<span class="co">#&gt; 12 2014-10-20 0.9122727      f</span>
<span class="co">#&gt; 13 2014-10-27 0.9027890      f</span>
<span class="co">#&gt; 14 2014-08-04 0.7566712      m</span>
<span class="co">#&gt; 15 2014-08-11 0.8164693      m</span>
<span class="co">#&gt; 16 2014-08-18 0.8567850      m</span>
<span class="co">#&gt; 17 2014-08-25 0.8820669      m</span>
<span class="co">#&gt; 18 2014-09-01 0.9006668      m</span>
<span class="co">#&gt; 19 2014-09-08 0.9166004      m</span>
<span class="co">#&gt; 20 2014-09-15 0.9271862      m</span>
<span class="co">#&gt; 21 2014-09-22 0.9263339      m</span>
<span class="co">#&gt; 22 2014-09-29 0.9260695      m</span>
<span class="co">#&gt; 23 2014-10-06 0.9216350      m</span>
<span class="co">#&gt; 24 2014-10-13 0.9144120      m</span>
<span class="co">#&gt; 25 2014-10-20 0.9077086      m</span>
<span class="co">#&gt; 26 2014-10-27 0.8966333      m</span>
<span class="no">fg.ifl</span>$<span class="no">plot</span></pre></body></html></div>
<p><img src="incidence_fit_class_files/figure-html/list_stuff-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Thibaut Jombart, Zhian N. Kamvar, Rich FitzJohn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
